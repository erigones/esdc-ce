# *** IMPORTANT ***
# This file is auto-generated by /opt/erigones/bin/esdc-overlay
# Do not edit manually.
# If you want to add other ipfilter rules, create a new
# file in directory /opt/custom/etc/ipf.d/.
#

# allow administrator IP sources
{% for administrator_ip in fw_administrator_IPs %}
{% if administrator_ip %}
pass in quick on external0 from {{ administrator_ip }} to {{ external_ip }} keep state
{% endif %}
{% endfor %}


# allow communication between compute nodes using external IPs
{% for node in all_nodes %}
{% if hostvars[node]['ansible_external0'] is defined and hostvars[node]['ansible_external0']['ipv4'][0] is defined and hostvars[node]['ansible_external0']['ipv4'][0]['address'] is defined and external_ip != 0 %}
pass in quick on external0 from {{ hostvars[node]['ansible_external0']['ipv4'][0]['address'] }} to {{ external_ip }} keep state
{% endif %}
{% endfor %}

{% if fw_administrator_IPs %}
# allow all other outgoing traffic
pass out quick on external0 all keep state
# block everything else
block in quick on external0 all
{% else %}
# not blocking unmatched incoming traffic
{% endif %}

