
- name: Read current metadata
  shell: mdata-list
  register: mdata_list
  changed_when: false

#
# https://github.com/erigones/esdc-ce/issues/401
#
- name: Save hostname into metadata
  shell: mdata-put hostname "{{ ansible_hostname }}"
  when: "hostname" not in mdata_list.stdout_lines

- name: Save hostname into /etc/hostname
  copy:
    dest: /etc/hostname
    content: "{{ ansible_hostname }}"

